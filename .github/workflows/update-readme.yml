# üîπ –û–Ω —Å–æ–±–∏—Ä–∞–µ—Ç README.md –∏–∑ —Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π
# üîπ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –≤ `$PARTS/`
# üîπ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –≤–µ—Ç–∫—É main ## –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—à–∏—Ç—å –≤ –¥—Ä—É–≥—É—é –≤–µ—Ç–∫—É —Ç–æ –≤–∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–µ–Ω—è–µ–º `main` –≤ `HEAD:main` –Ω–∞ –≤–∞—à—É –≤–µ—Ç–∫—É
# üîπ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö GitHub runners (ubuntu-latest)
# üîπ https://docs.github.com/en/actions/reference/workflows-and-actions/events-that-trigger-workflows#schedule


name: UPDATE-README from parts

on:
  workflow_dispatch: # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

  schedule:
    - cron: '10 9 * * *'  # –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00 UTC
    # –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ 12:00 –ø–æ –ú–æ—Å–∫–≤–µ ‚Üí –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ "0 9 * * *"


  push:
    paths:
      - "$README_PARTS/*" # —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
      - ".github/README_PARTS/*"
      - ".github/README_PARTS/5.MAIN_Article_*.md"

permissions:
  contents: write      # –†–∞–∑—Ä–µ—à–∞–µ–º action —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–º–∏—Ç—ã


jobs:
  build-readme:
    runs-on: ubuntu-latest
    name: üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è README.md –∏–∑ —á–∞—Å—Ç–µ–π
    steps:
    - name: üîÑ –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–ø—É—Å–∫–µ
      run: |
        echo "üéâ –ó–∞–ø—É—â–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ–º ${{ github.event_name }}"
        echo "üêß –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: ${{ runner.os }}"

    - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤
        clean: true # –æ—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π

    - name: üìå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: üìÇ –°–±–æ—Ä–∫–∞ README.md
      run: |
        # –ø—É—Ç–∏
        PARTS=".github/README_PARTS"

        # –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        OUTPUT="README.md"

        # —Ñ–∞–π–ª—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.
        HEADER="$PARTS/1.HEADER.md"
        DESCRIPTION="$PARTS/2.DESCRIPTION.md"
        DONATION="$PARTS/3.DONATION.md"
        NAV="$PARTS/4.NAV.md"
        MAIN_Header="$PARTS/5.MAIN_Header.md"
        FOOTER="$PARTS/6.FOOTER.md"

        # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å—Ç–∞—Ç—å–∏ MAIN_Article_* –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤—ã–≤–∞–µ–º –ø–æ –Ω–æ–º–µ—Ä—É
        MAIN_ARTICLES=$(ls $PARTS/5.MAIN_Article_*.md 2>/dev/null | sort -V || true)
        echo "üìÑ –ù–∞–π–¥–µ–Ω—ã —Å—Ç–∞—Ç—å–∏ MAIN_Article_:"
        echo "$MAIN_ARTICLES"


              # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
        if [[ ! -f "$HEADER" || ! -f "$DESCRIPTION" || ! -f "$DONATION" || ! -f "$FOOTER" ]]; then
          echo "‚ùå –û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–∏–Ω –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤!"
          exit 1
        fi



        # –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–±–∏—Ä–∞—Ç—å README —Å –¥–≤—É–º—è –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏
        cat "$HEADER" > "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"

        cat "$DESCRIPTION" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"

        cat "$DONATION" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"

        cat "$NAV" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"

        cat "$MAIN_Header" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"

        for ARTICLE in $MAIN_ARTICLES; do
          echo "üìå –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—å—é: $ARTICLE"
          cat "$ARTICLE" >> "$OUTPUT"
          echo -e "\n\n" >> "$OUTPUT"
        done

        cat "$FOOTER" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"


        echo "‚úÖ README.md —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω."

    - name: üíæ Commit –∏ Push README
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git add README.md
        git commit -m "Auto-generate README from parts" || echo "‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏"
        git push "https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git" HEAD:main
