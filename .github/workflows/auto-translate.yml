name: Перевод README на английский

on:
  workflow_dispatch: # ручной запуск
  
  push:
    paths:
      - "README.md"   # Запускаем workflow только при изменении README.md

permissions:
  contents: write      # Разрешаем action создавать коммиты

jobs:
  translate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4   # Клонируем репозиторий

      - name: Чтение README.md
        id: read
        run: |
          # Читаем содержимое README.md
          content=$(cat README.md)

          # Экранируем кавычки, чтобы текст корректно прошёл в JSON
          content="${content//\"/\\\"}"

          # Передаём результат в следующий шаг
          echo "content=$content" >> $GITHUB_OUTPUT

      - name: Перевод через GitHub Copilot Chat API
        id: translate
        uses: github/copilot-actions/cli@v1
        with:
          # Запрос Copilot: перевести Markdown на английский, сохранив форматирование
          query: "Переведи следующий Markdown-текст на английский, сохранив форматирование:\n${{ steps.read.outputs.content }}"

      - name: Сохраняем перевод
        run: |
          # Создаём файл README_en_EN.md и записываем туда ответ Copilot
          echo "${{ steps.translate.outputs.response }}" > README_en_EN.md

      - name: Коммит перевода
        run: |
          # Настройка данных автора коммита
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Actions"

          # Добавляем новый файл
          git add README_en_EN.md

          # Коммитим изменения (если они есть)
          git commit -m "Автоперевод README на английский" || echo "Нет изменений для коммита"

          # Пушим в репозиторий
          git push
